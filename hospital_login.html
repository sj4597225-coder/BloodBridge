<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BloodBridge - Hospital Staff Registration</title>
    <link rel="stylesheet" href="hospital_login.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>

<body>
    <div class="background-animation">
        <div class="pulse-circle pulse-1"></div>
        <div class="pulse-circle pulse-2"></div>
        <div class="pulse-circle pulse-3"></div>
    </div>

    <div class="container">
        <div class="registration-card">
            <div class="logo-section">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                            fill="currentColor" />
                    </svg>
                </div>
                <h1 class="app-title">Hospital Staff Registration</h1>
                <p class="app-subtitle">Join BloodBridge Network</p>
            </div>

            <form id="hospitalForm" class="registration-form">
                <!-- Hospital Name with Search -->
                <div class="form-group">
                    <label for="hospitalName" class="form-label">
                        <svg class="label-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <polyline points="9 22 9 12 15 12 15 22" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        Hospital Full Name
                    </label>
                    <div class="search-container">
                        <input type="text" id="hospitalName" name="hospitalName" class="form-input"
                            placeholder="Search nearby hospitals or enter manually" required autocomplete="off">

                        <div class="suggestions-dropdown" id="hospitalSuggestions"></div>
                    </div>
                </div>



                <!-- Contact Number -->
                <div class="form-group">
                    <label for="contact" class="form-label">
                        <svg class="label-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        Hospital Contact Number
                    </label>
                    <input type="tel" id="contact" name="contact" class="form-input" placeholder="+91 XXXXX XXXXX"
                        pattern="[0-9+\s-]+" required>
                </div>


                <!-- Staff Name -->
                <div class="form-group">
                    <label for="staffName" class="form-label">
                        <svg class="label-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        Staff Name
                    </label>
                    <input type="text" id="staffName" name="staffName" class="form-input"
                        placeholder="Enter your full name" required>
                </div>

                <!-- Staff Contact -->
                <div class="form-group">
                    <label for="staffContact" class="form-label">
                        <svg class="label-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        Staff Contact Number
                    </label>
                    <input type="tel" id="staffContact" name="staffContact" class="form-input"
                        placeholder="+91 XXXXX XXXXX" pattern="[0-9+\s-]+" required>
                </div>

                <!-- Staff Email -->
                <div class="form-group">
                    <label for="staffEmail" class="form-label">
                        <svg class="label-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        Staff Email Address
                    </label>
                    <input type="email" id="staffEmail" name="staffEmail" class="form-input"
                        placeholder="yourname@example.com" required>
                    <p class="form-hint">OTP will be sent to this email for verification</p>
                </div>
                <div class="form-group">
                    <label for="staffIdUpload" class="form-label">
                        <svg class="label-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <circle cx="9" cy="10" r="2" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M6 16c0-1.1.9-2 2-2h2c1.1 0 2 .9 2 2" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <line x1="15" y1="9" x2="19" y2="9" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <line x1="15" y1="13" x2="19" y2="13" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        Upload Staff ID
                    </label>
                    <div class="file-upload-wrapper">
                        <!-- File Upload Area - Matched with Donor Form -->
                        <div class="upload-area-small" id="idUploadArea">
                            <div class="upload-content-small" id="idUploadContent">
                                <svg class="upload-icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                <p class="upload-text-small">Click or drag ID image here</p>
                                <p class="file-info-small">Aadhar / PAN / Driving License</p>
                            </div>
                            <div class="preview-area-small" id="idPreviewArea" style="display: none;">
                                <img id="idPreviewImage" src="" alt="ID Preview">
                                <button type="button" class="change-btn-small" id="idChangeBtn">Change</button>
                            </div>
                        </div>
                        <input type="file" id="staffIdUpload" name="staffIdUpload" accept="image/*" hidden required>
                        <div class="error-message" id="idError"
                            style="display: none; color: var(--primary-red); font-size: 13px; margin-top: 6px;">Please
                            upload a valid ID</div>
                    </div>
                    <p class="form-hint">Upload your staff ID card (PDF, JPG, PNG - Max 5MB)</p>
                </div>


                <!-- Location (Auto-filled) -->
                <div class="form-group">
                    <label for="location" class="form-label">
                        <svg class="label-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        Hospital Address
                    </label>
                    <textarea id="location" name="location" class="form-input location-textarea"
                        placeholder="Address where you are mostly available" rows="3"></textarea>
                    <div id="mapLinkContainer" style="display: none; margin-top: 12px;"></div>
                    <p class="form-hint">This field will be automatically filled when you select a hospital</p>
                </div>

                <!-- Terms and Conditions -->
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="terms" name="terms" class="checkbox-input" required>
                        <span class="checkbox-custom"></span>
                        <span class="checkbox-text">
                            I agree to the <a href="#" class="link">Terms and Conditions</a> and confirm that all
                            information provided is accurate
                        </span>
                    </label>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="submit-btn" id="submitBtn" ahref="hospital_staff_login.html">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <span>Next page</span>
                </button>
            </form>

            <div class="footer-section">
                <p class="footer-text">Already registered? <a href="hospital_portal_landing.html"
                        class="back-link">Login
                        here</a></p>
            </div>


        </div>

    </div>

    <script src="db.js"></script>
    <script src="hospital_login.js?v=3"></script>
    <script>
        // Save hospital staff registration to Flask backend on submit
        document.getElementById('hospitalForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            // Clear previous errors
            const idError = document.getElementById('idError');
            if (idError) idError.style.display = 'none';

            const submitBtn = document.getElementById('submitBtn');
            const staffIdFile = document.getElementById('staffIdUpload')?.files[0];

            // Manual validation for file upload
            if (!staffIdFile) {
                if (idError) idError.style.display = 'block';
                // Scroll to error
                idError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            submitBtn.disabled = true;
            const spanEl = submitBtn.querySelector('span');
            if (spanEl) spanEl.textContent = 'Submitting...';

            const fd = new FormData();
            fd.append('hospitalName', document.getElementById('hospitalName')?.value || '');
            fd.append('contact', document.getElementById('contact')?.value || '');
            fd.append('staffName', document.getElementById('staffName')?.value || '');
            fd.append('staffContact', document.getElementById('staffContact')?.value || '');
            fd.append('staffEmail', document.getElementById('staffEmail')?.value || '');
            fd.append('location', document.getElementById('location')?.value || '');
            if (staffIdFile) fd.append('staffIdUpload', staffIdFile);

            try {
                const res = await fetch('/api/hospital-staff', {
                    method: 'POST',
                    body: fd
                });
                const data = await res.json();
                if (res.ok && data.success) {
                    // Store phone and email for OTP verification
                    const staffPhone = document.getElementById('staffContact')?.value || '';
                    const staffEmail = document.getElementById('staffEmail')?.value || '';
                    sessionStorage.setItem('bb_otp_phone', staffPhone);
                    sessionStorage.setItem('bb_otp_email', staffEmail);
                    // Redirect to OTP verification page
                    window.location.href = 'hospital_otp_verify.html';
                } else {
                    alert('Error: ' + (data.error || 'Submission failed'));
                    submitBtn.disabled = false;
                    if (spanEl) spanEl.textContent = 'Next page';
                }
            } catch (err) {
                alert('Cannot connect to server. Make sure Flask is running on port 5000.');
                submitBtn.disabled = false;
                if (spanEl) spanEl.textContent = 'Next page';
            }
        });
    </script>
</body>

</html>